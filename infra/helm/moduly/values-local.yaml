# Local Development Values for Moduly Helm Chart
# This file contains configurations optimized for local Kubernetes testing
# (Docker Desktop, Minikube, etc.)

# =============================================================================
# Secrets (Local Development Values)
# =============================================================================
secrets:
  # Database password
  dbPassword: "moduly123"
  
  # Redis password
  redisPassword: "redis123"
  
  # JWT secret key (for development only!)
  secretKey: "local-dev-jwt-secret-key-DO-NOT-USE-IN-PRODUCTION"
  
  # Master encryption key (optional)
  masterKey: ""
  
  # Encryption key (optional)
  encryptionKey: ""
  
  # Sandbox API key
  sandboxApiKey: "Modulycallsandbox306"
  
  # Google OAuth credentials (optional - leave empty for local)
  googleClientId: ""
  googleClientSecret: ""
  
  # Llama Cloud API key (optional)
  llamaCloudApiKey: ""

# =============================================================================
# PostgreSQL Configuration (Use embedded chart for local)
# =============================================================================
postgresql:
  enabled: true
  auth:
    username: moduly
    password: moduly123
    database: moduly
  primary:
    persistence:
      enabled: true
      size: 2Gi  # Smaller for local testing
    # Fix: Allow writable filesystem for lock files
    containerSecurityContext:
      readOnlyRootFilesystem: false

# =============================================================================
# Redis Configuration (Use embedded chart for local)
# =============================================================================
redis:
  enabled: true
  auth:
    password: redis123
  # Override image to use existing version
  image:
    registry: docker.io
    repository: bitnami/redis
    tag: latest  # Use latest for local testing
  master:
    persistence:
      enabled: true
      size: 500Mi  # Smaller for local testing
    # Fix: Allow writable filesystem for lock files
    containerSecurityContext:
      readOnlyRootFilesystem: false

# =============================================================================
# Resource Limits (Reduced for local environments)
# =============================================================================
gateway:
  replicas: 1  # Single replica for local
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
  # Override environment for localhost port-forward testing
  env:
    CORS_ORIGINS: "http://localhost:3000,http://127.0.0.1:3000"
    SANDBOX_URL: "http://localhost:8194"  # Port-forward sandbox

worker:
  replicas: 1  # Single replica for local
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
  # Override environment for localhost
  env:
    SANDBOX_URL: "http://localhost:8194"

logger:
  replicas: 1
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 64Mi

frontend:
  replicas: 1
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
  # Override API URL for local port-forward testing
  env:
    # Client-side (browser) API URL
    NEXT_PUBLIC_API_URL: "http://localhost:8000"
    # Server-side (SSR) API URL - uses Kubernetes service
    API_URL: "http://my-moduly-gateway:8000"

sandbox:
  replicas: 1
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi

# =============================================================================
# Ingress (Disabled for local - use port-forward instead)
# =============================================================================
ingress:
  enabled: false
