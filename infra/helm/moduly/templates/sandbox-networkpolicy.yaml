{{- if and .Values.sandbox.enabled .Values.sandbox.networkPolicy.enabled }}
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: {{ include "moduly.fullname" . }}-sandbox-egress
  labels:
    {{- include "moduly.componentLabels" (dict "component" "sandbox" "context" .) | nindent 4 }}
spec:
  podSelector:
    matchLabels:
      {{- include "moduly.componentSelectorLabels" (dict "component" "sandbox" "context" .) | nindent 6 }}
  policyTypes:
  - Ingress
  - Egress
  
  ingress:
  - from:
    - podSelector: {}
    ports:
    - protocol: TCP
      port: 8194
  
  egress:
  # 1. DNS 허용 (필수)
  - ports:
    - protocol: UDP
      port: 53
    - protocol: TCP
      port: 53
  # 2. 나머지는 모두 차단 (기본 Deny)
{{- end }}